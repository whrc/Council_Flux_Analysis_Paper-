---
title: "Council_IncMSE_CH4" #script for exploring deconstructed incMSE models for correlated variables 
#Note: optimal OOB determined in BASE data prepping proj, script 1.5 "Optimizing RF ntree OOB"


output: html_document
date: "2025-09-04"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=FALSE}
rm(list = ls())

library(data.table)
library(ggplot2)
library(cowplot)
library(openair)
library(plotrix)
library(signal)
library(svMisc)
library(zoo)
library(stringr)
library(plyr)
library(viridis)
library(lubridate)
library(tidyverse)
library(gridExtra)
library(plotly)
library(RColorBrewer)
library(pracma)
library(dplyr)
library(car)


Sys.setenv(TZ='UTC')
```


#ERA dataset 
####Prepping the era dataset to use to train RF too -- calc vpd and RF for SWC gapfilling, just like in the processing steps 
```{r}
#ERA-5 dataset for RF training - just like in step 2 of the processing code -- uses the same dataset used in the beginning of step 2 
df_era = fread("C:/Users/kkent/Documents/Council Data/Council BASE gapfilling/council_2016_2023_era.csv") #using the re-cleaned df from Dani 

#subset out by which has complete air t data 
df_era = df_era[complete.cases(df_era$airt.eramod),]

#create subset of the variables wanted for training RF 
df_era2 = data.frame(df_era$date,df_era$FC.c,df_era$FCH4.c,
                 df_era$airt.eramod, df_era$wd, df_era$cardinal_direction, df_era$rh.eramod,df_era$rad.eramod,
                 df_era$ws.eramod,df_era$tsoil.eramod,#df_era$SWC_1_1_1.c,df_era$SWC_2_1_1.c, 
                 df_era$SWC_3_1_1.c, #SWC 3 = the tussock location 
                 df_era$h.eramod,df_era$le.eramod)

#rename for easier names
names(df_era2) = c('date','nee',"fch4",'tair', 'wd', 'cardDir','rh','rg','ws','tsoil','swc','h','le')

#make card dir as factor - 8 levels 
df_era2$cardDir <- as.factor(df_era2$cardDir)

#calculate VPD from air t and RH
svp = 610.7*10^((7.5*df_era2$tair)/(237.3+df_era2$tair))
df_era2$vpd = ((100 - df_era2$rh)/100)*svp  
```


#RF for SWC - Train RF to fill in SWC (using SWC3, tussocklocation*)
```{r}

#Subset dataset into training and testing dataset 

set.seed(123)#sets the start point of models, good for repeatability
cc = df_era2[complete.cases(df_era2$swc),]#create a gap free data set of the target variable

#use 80% of data set as training set and 20% as test set
sample = sample(c(TRUE, FALSE), nrow(cc), replace=TRUE, prob=c(0.8,0.2))
train  = cc[sample, ]
test   = cc[!sample, ]
#compare to ensure all data sets are representative of total data
hist(cc$swc)
hist(train$swc)
hist(test$swc)

#run random forest to predict missing SWC values 
library(randomForest)

rf.swc = randomForest(formula = swc ~ tair + rh + rg + ws + wd + tsoil + vpd + le + h,data = train,ntree = 800) #optimum ntree determined by OOB error (script in Council Base data prepping, #1.5)

#predict it on the full data set
swc.rf = predict(object = rf.swc,newdata = df_era2)
df_era2$swc.rf = swc.rf 

#time series plot of gap filled vs real
ggplot(data = df_era2)+
  geom_point(aes(date,swc.rf*100,col='RF'))+
  geom_point(aes(date,swc*100,col='Measured'))+
  scale_y_continuous("SWC (%)")


#validation dataset from only test data
val = merge(test,df_era2,by = "date",all.x = T)

ggplot(data = val,aes(swc.rf,swc.x))+theme_bw()+geom_abline(slope = 1,intercept = 0,col='red')+
  geom_point(alpha=0.1)+
  scale_x_continuous(limits = c(0,70),"RF SWC (%)")+
  scale_y_continuous(limits = c(0,70),"Measured SWC (%)")

#summary stats on gap filling
summary(lm(val$swc.x ~ val$swc.rf)) #R2 = 0.97, slope = 1.02

#create final gap free soil moisture
df_era2$swc = ifelse(is.na(df_era2$swc),df_era2$swc.rf,df_era2$swc)

```

#SWC-soil temp interaction term - add to swc-gapfilled dataframe 
```{r}
# Create interaction term --> explicit interaction term while keeping original terms 
df_era2$TS_SWC_interact <- df_era2$tsoil * df_era2$swc
```



#Checking collinearity among continuous predictor variables - gives an idea of how to approach iterative model reduction of correlated / collinear vars
```{r}
library(corrplot)
library(car)
library(dplyr)
# CORRELATION MATRIX - Visual inspection
# Predictor variables
predictors <- df_era2 %>%
  select(tair, rh, rg, ws, wd, tsoil, vpd, swc, h, le, TS_SWC_interact) %>%
  na.omit()  # Remove rows with any missing values

# Calculate correlation matrix using complete observations 
cor_matrix <- cor(predictors, use = "complete.obs", method = "spearman")
print("Spearman Correlation Matrix:")
print(round(cor_matrix, 3))

# Visualize correlation matrix
corrplot(cor_matrix, method = "color", type = "upper", 
         order = "hclust", tl.cex = 0.8, tl.col = "black",
         addCoef.col = "black", number.cex = 0.7)
title("Collinearity Check: Spearman Correlation Matrix")

# Identify highly correlated pairs (|r| > 0.7) - code from claude
high_cor_pairs <- which(abs(cor_matrix) > 0.7 & abs(cor_matrix) < 1, arr.ind = TRUE)
if(nrow(high_cor_pairs) > 0) {
  print("Variable pairs with |correlation| > 0.7:")
  for(i in 1:nrow(high_cor_pairs)) {
    var1 <- rownames(cor_matrix)[high_cor_pairs[i,1]]
    var2 <- colnames(cor_matrix)[high_cor_pairs[i,2]]
    cor_val <- cor_matrix[high_cor_pairs[i,1], high_cor_pairs[i,2]]
    cat(paste(var1, "vs", var2, ": r =", round(cor_val, 3), "\n"))
  }
} else {
  print("No variable pairs with |correlation| > 0.7 found")
}
#Results: most of them have collinearity / correlation 
# strongest correlations: 
#swc - tsoil, TS interact, tair, vpd, le 
#tsoil - swc, TS interact, tair, vpd, le
#TS interact - tair, vpd, le 
#tair - vpd, le, rg, h
#vpd - le, rg, h, rh
#wd - ok
#le - rg, h, rh
#rg - h, rh
#h - rh
#ws - ok 
```
# VarImp for CH4

#Now we start removing / swapping out variables that appear to be collinear (see VIF, corr matrix). #My approach is to remove the variables with the highest VIF after each model run


#Running with complete cases of ALL variables used in the model, and using the whole df_era2 dataset 

#complete cases of all predictor variables being used and complete cases of obs fch4 (not gapfilled)

```{r}
#Complete cases of fch4
cc_fch4 = df_era2[complete.cases(df_era2$fch4),]


#subset out cc of all variables within the model 
cc_all = cc_fch4[complete.cases(cc_fch4$tair, cc_fch4$wd, cc_fch4$cardDir, cc_fch4$rh, cc_fch4$rg, cc_fch4$ws, cc_fch4$tsoil, cc_fch4$swc, cc_fch4$h, cc_fch4$le, cc_fch4$vpd),]

#double check no 0 or NA values 
sum(is.na(cc_all$fch4))
```

#SWC-soil temp interaction term 
```{r}
# Create interaction term --> explicit interaction term while keeping original terms 
cc_all$TS_SWC_interact <- cc_all$tsoil * cc_all$swc
```

#Boruta variable importance
```{r}
#added wd (degrees)
library(Boruta)

boruta = Boruta(fch4 ~ tair + rh + rg + ws + wd + tsoil + swc + vpd + le + h + TS_SWC_interact, data = cc_all, doTrace = 2,maxRuns = 100)
boruta$finalDecision #indicates all above are confirmed important variables via a list 
plot(boruta,las = 2) 
```

##### Full model with all variables & interaction term 
```{r}
#interaction term in ERA5 dataset, for reference: TS_SWC_interact

#Create training and testing datasets 

#Here we tried constraining to remove outliers, but the constrained version performed slightly worse so we left it unconstrained 
# cc = subset(cc,cc$fch4 < 60)
# cc = subset(cc,cc$fch4 > -25)


rf.fch4_full.cc <- randomForest(fch4 ~ tair + rh + rg + ws + wd + tsoil + 
                             vpd + swc + h + le + TS_SWC_interact ,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tair + rh + rg + ws + wd + tsoil + vpd + swc + h + le + TS_SWC_interact, data = cc_all)
# 
 vif(vif_model) 
#   tair              rh              rg              ws              wd 
#       10.936677        3.853300       12.763997        1.225279        1.082375 
#           tsoil             vpd             swc               h              le 
#       31.678038       14.060301        2.151849        6.997102        6.254210 
# TS_SWC_interact 
#       20.928256 

# Extract variable importance
importance_values <- importance(rf.fch4_full.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_full.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#                  %IncMSE
# tair             58.53514
# rh               86.13987
# rg               70.56241
# ws              123.86354 *
# wd              162.89566 *
# tsoil            79.94184
# vpd              45.93634
# swc             142.91566 *
# h               102.54686
# le               78.40838
# TS_SWC_interact  56.01636

```
#reduced model 1: removing soil temp - soil moisture interaction first since it was a newly introduced variable 
```{r}

rf.fch4_1.cc <- randomForest(fch4 ~ tair + rh + rg + ws + wd + tsoil + 
                             vpd + swc + h + le,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tair + rh + rg + ws + wd + tsoil + vpd + swc + h + le, data = cc_all)

 vif(vif_model)
#      tair        rh        rg        ws        wd     tsoil       vpd       swc         h 
# 10.093012  3.729245 12.720959  1.204906  1.078491  8.321247 13.782132  2.114541  6.981805 
#        le 
#  6.249209 

# Extract variable importance
importance_values <- importance(rf.fch4_1.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_1.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#         %IncMSE
# tair   73.97577
# rh    103.92990
# rg     64.80313
# ws    131.48767 *
# wd    176.10341 *
# tsoil 101.86235
# vpd    60.47862
# swc   180.30506 *
# h     103.48422
# le     79.66828
```
#reduced model 2: removing VPD & soil moist-temp interaction 
```{r}

rf.fch4_2.cc <- randomForest(fch4 ~ tair + rh + rg + ws + wd + tsoil + swc + h + le,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tair + rh + rg + ws + wd + tsoil + swc + h + le, data = cc_all)

 vif(vif_model) 
 #     tair        rh        rg        ws        wd     tsoil       swc         h        le 
 # 7.560959  1.982846 12.687023  1.149830  1.074716  7.040197  1.901910  6.858562  5.467961 

# Extract variable importance
importance_values <- importance(rf.fch4_2.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_2.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#         %IncMSE
# tair   80.85422
# rh    107.42584
# rg     67.30278
# ws    137.93487 *
# wd    174.16710 *
# tsoil 112.65633
# swc   183.18100 *
# h     100.07992
# le     82.13178
```
#reduced model 3: removing VPD, soil moist-temp interaction, rg 
```{r}

rf.fch4_3.cc <- randomForest(fch4 ~ tair + rh + ws + wd + tsoil + swc + h + le,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tair + rh + ws + wd + tsoil + swc + h + le, data = cc_all)

 vif(vif_model) 
#     tair       rh       ws       wd    tsoil      swc        h       le 
# 5.338311 1.765234 1.120391 1.074628 5.508347 1.767473 3.028133 4.452994 

# Extract variable importance
importance_values <- importance(rf.fch4_3.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_3.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#         %IncMSE
# tair   85.77758
# rh    108.42241
# ws    131.63980 *
# wd    161.68607 *
# tsoil 108.90487
# swc   172.16055 *
# h     112.93053
# le     76.50481
```
#reduced model 4: removing VPD, soil moist-temp interaction, rg, tsoil   
```{r}

rf.fch4_4.cc <- randomForest(fch4 ~ tair + rh + ws + wd + swc + h + le,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tair + rh + ws + wd + swc + h + le, data = cc_all)

 vif(vif_model) 
#     tair       rh       ws       wd      swc        h       le 
# 2.355277 1.765049 1.091466 1.063787 1.489104 3.025116 4.448587 

# Extract variable importance
importance_values <- importance(rf.fch4_4.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_4.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#        %IncMSE
# tair 144.42222
# rh   116.75788
# ws   146.20746 *
# wd   166.14833 *
# swc  222.81562 *
# h    114.36530
# le    89.04512

```
#reduced model 5: removing VPD, soil moist-temp interaction, rg, *Swapping out tair and adding tsoil back in   
```{r}

rf.fch4_5.cc <- randomForest(fch4 ~ tsoil + rh + ws + wd + swc + h + le,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tsoil + rh + ws + wd + swc + h + le, data = cc_all)

 vif(vif_model) 
#    tsoil       rh       ws       wd      swc        h       le 
# 2.430297 1.751345 1.120095 1.073763 1.767440 3.019948 4.187085 

# Extract variable importance
importance_values <- importance(rf.fch4_5.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_5.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#        %IncMSE
# tsoil 130.7253
# rh    123.5868
# ws    149.4021 *
# wd    178.1276 *
# swc   168.3581 *
# h     121.0988
# le    101.8783

#tair has higher incMSE compared to tsoil when the other is excluded 
#for both versions, le has the highest VIF so removing that next 
```
#reduced model 6: removing VPD, soil moist-temp interaction, rg, tsoil, and le    
```{r}

rf.fch4_6.cc <- randomForest(fch4 ~ tair + rh + ws + wd + swc + h,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tair + rh + ws + wd + swc + h, data = cc_all)

 vif(vif_model) 
#    tair       rh       ws       wd      swc        h 
# 1.971821 1.446072 1.078981 1.063236 1.485848 1.767071 

# Extract variable importance
importance_values <- importance(rf.fch4_6.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_6.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#       %IncMSE
# tair 171.5401 *
# rh   131.6919
# ws   164.5995
# wd   192.9932 *
# swc  260.8216 *
# h    159.1251

#swc then wd then tair most important when tsoil removed 

```
#reduced model 7: removing VPD, soil moist-temp interaction, rg, *tair, and le    
```{r}

rf.fch4_7.cc <- randomForest(fch4 ~ tsoil + rh + ws + wd + swc + h,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tsoil + rh + ws + wd + swc + h, data = cc_all)

 vif(vif_model) 
#    tsoil       rh       ws       wd      swc        h 
# 2.161699 1.445655 1.106557 1.072538 1.765819 1.625891 

# Extract variable importance
importance_values <- importance(rf.fch4_7.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_7.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#        %IncMSE
# tsoil 154.6973
# rh    134.8141
# ws    166.2500
# wd    206.2783 *
# swc   177.1358 *
# h     170.5901 *

#wd then swc then h most important when tsoil is included and tair is removed 

#tair has greater incMSE, suggesting it's more important to model accuracy than tsoil 



```
#reduced model 8: removing VPD, rg, tsoil, tair, and le -- *adding in soil temp-moist interaction
```{r}

rf.fch4_8.cc <- randomForest(fch4 ~ TS_SWC_interact + rh + ws + wd + swc + h,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ TS_SWC_interact + rh + ws + wd + swc + h, data = cc_all)

 vif(vif_model) 
# TS_SWC_interact              rh              ws              wd             swc 
#        2.034987        1.444602        1.085805        1.066965        1.742839 
#               h 
#        1.586864 

# Extract variable importance
importance_values <- importance(rf.fch4_8.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_8.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#                  %IncMSE
# TS_SWC_interact 169.6829
# rh              139.8206
# ws              150.1531
# wd              201.2506 *
# swc             190.3431 *
# h               176.8031 *

```
#VIF all ok, but h & rh are collinear per the spearman corr matrix, so removing and swapping to see how this changes model 


#reduced model 9: removing interaction, VPD, rg, tair, le, rh 
```{r}

rf.fch4_9.cc <- randomForest(fch4 ~ tsoil + ws + wd + swc + h,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tsoil + ws + wd + swc + h, data = cc_all)

 vif(vif_model) 
#    tsoil       ws       wd      swc        h 
# 2.160115 1.064964 1.041696 1.749001 1.232779 

# Extract variable importance
importance_values <- importance(rf.fch4_9.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_9.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#        %IncMSE
# tsoil 132.7951
# ws    155.6349
# wd    197.2607 *
# swc   158.5033 *
# h     190.3384 *

```


#reduced model 10: removing VPD, rg, tair, le, swapping out *h and rh 
```{r}

rf.fch4_10.cc <- randomForest(fch4 ~ tsoil + ws + wd + swc + rh,
                             data = cc_all,
                             ntree = 950,
                             importance = TRUE)


 vif_model <- lm(fch4 ~ tsoil + ws + wd + swc + rh, data = cc_all)

 vif(vif_model) 
#    tsoil       ws       wd      swc       rh 
# 1.908408 1.104641 1.057841 1.744207 1.096122 

# Extract variable importance
importance_values <- importance(rf.fch4_10.cc, type = 1)  # type = 1 for %IncMSE

# Print the importance values
print(importance_values)

# Plot the importance values
varImpPlot(rf.fch4_10.cc, type = 1, main = "CH4: Variable Importance (%IncMSE)")

#        %IncMSE
# tsoil 130.4735
# ws    175.5044 *
# wd    209.6973 *
# swc   165.9469
# rh    177.4547 *

```



#Testing which model may be better, comparing the reduced models using tair and tsoil 
#### *anova doesn't work on randomforest products, so tried on simple lm 
#### AIC/BIC also don't work for RF models, so tried on simple lm 

```{r}

#using OOB and RMSE to compare the reduced models 6 and 7 which swaps tsoil and tair

oob_mse_6 <- tail(rf.fch4_6.cc$mse, 1)
oob_r2_6  <- tail(rf.fch4_6.cc$rsq, 1)

oob_mse_7 <- tail(rf.fch4_7.cc$mse, 1)
oob_r2_7  <- tail(rf.fch4_7.cc$rsq, 1)

data.frame(model = c("airT", "soilT"),
           OOB_MSE = c(oob_mse_6, oob_mse_7),
           OOB_R2  = c(oob_r2_6,  oob_r2_7))

# # model      OOB MSE               OOB R2
# airT	       47.90983	            0.4804274		
# soilT	      46.91144            	0.4912548	

#tsoil has slightly lower error, and slightly higher R2, indicates it may be the better model 


#looking at model 8 with interaction term added back in 
oob_mse_8 <- tail(rf.fch4_8.cc$mse, 1)
oob_r2_8  <- tail(rf.fch4_8.cc$rsq, 1)

data.frame(model = c("airT", "soilT", "interaction"),
           OOB_MSE = c(oob_mse_6, oob_mse_7, oob_mse_8),
           OOB_R2  = c(oob_r2_6,  oob_r2_7, oob_r2_8))


#tsoil model still slightly best

# # model      OOB MSE               OOB R2
# airT	       47.90983	            0.4804274		
# soilT	      46.91144            	0.4912548		
# interaction	47.02965	            0.4899728		


#looking at models 6 - 10 
oob_mse_9 <- tail(rf.fch4_9.cc$mse, 1)
oob_r2_9  <- tail(rf.fch4_9.cc$rsq, 1)

oob_mse_10 <- tail(rf.fch4_10.cc$mse, 1)
oob_r2_10  <- tail(rf.fch4_10.cc$rsq, 1)

data.frame(model = c("airT", "soilT", "interaction", "w/o h", "w/o rh"),
           OOB_MSE = c(oob_mse_6, oob_mse_7, oob_mse_8, oob_mse_9, oob_mse_10),
           OOB_R2  = c(oob_r2_6,  oob_r2_7, oob_r2_8, oob_r2_9, oob_r2_10))

#model 7, with soil T, still performs best with lowest OOB MSE, highest OOB R2
```


#comparing lm models of reduced RF models - can't use anova since the two models have the same number of parameters and have a different parameter (they're not nested model comparisons) - so need a different test to see if the models are distinguishable & otherwise use AIC/BIC
```{r}
#lm to allow anova comparison 
lm_rf.fch4_6<- lm(fch4 ~ tair + rh + ws + wd + swc + h, data = cc_all)
lm_rf.fch4_7 <- lm(fch4 ~ tsoil + rh + ws + wd + swc + h, data = cc_all)

#anova(lm_rf.fch4_7,lm_rf.fch4_6 ) #doesn't generate a p value bc the models are not nested, so need a diff test 
AIC(lm_rf.fch4_7,lm_rf.fch4_6) #AIC for 6 = 187043.1, AIC for 7 = 186953.0 so 7 has slightly lower AIC
BIC(lm_rf.fch4_7,lm_rf.fch4_6) #BIC for 6 = 187108.3, BIC for 7 = 187018.2 so 7 has slightly lower BIC

vif(lm_rf.fch4_6) # all <2 - ok
vif(lm_rf.fch4_7) #tsoil at 2.2, rest < 2 -ok 

#Vuong test can test two different, non-nested models with different parameters - but not sure this is appropriate as the models don't adhere to lm assumptions.... 
library(nonnest2)

# Vuong test for non-nested model comparison
vuong_test <- vuongtest(lm_rf.fch4_6, lm_rf.fch4_7)
print("Vuong Test Results:")
print(vuong_test)

#shows models do perform sig diff from one another, and that model 2, the one with tsoil, performs better than the model with tair 


#now compare model 7 to models 9 and 10 

lm_rf.fch4_9 <- lm(fch4 ~ tsoil  + ws + wd + swc + h, data = cc_all)
lm_rf.fch4_10 <- lm(fch4 ~ tsoil  + ws + wd + swc + rh, data = cc_all)

AIC(lm_rf.fch4_7,lm_rf.fch4_9, lm_rf.fch4_10) #model 7 has lowest AIC
BIC(lm_rf.fch4_7,lm_rf.fch4_9, lm_rf.fch4_10) #model 7 has lowest AIC


#now, because models 9 and 10 are reduced compared to model 7, we can use the anova to compare the lm models 
anova(lm_rf.fch4_7, lm_rf.fch4_9) #sig diff, p<0.001
anova(lm_rf.fch4_7, lm_rf.fch4_10) #sig diff, p<0.001

```







